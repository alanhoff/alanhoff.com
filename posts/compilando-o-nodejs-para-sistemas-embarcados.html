<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Blog pessoal sobre JavaScript, Node.js, AngularJs, sistemas embarcados e outras cachaças.">
  <meta name="author" content="Alan Hoffmeister <alanhoffmeister@gmail.com>">

  <title>Alan Hoffmeister - Compilando o Node.js para sistemas embarcados</title>

  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://alanhoff.com/rss.xml">

  <!-- Fonts -->
  <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro%3A400%2C400italic%2C700" rel="stylesheet">
  <link href="//fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet">

  <!-- Bootstrap core CSS -->
  <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
  <link href="/assets/css/font-awesome.min.css" rel="stylesheet">
  <link href="/assets/css/bootstrap-social.css" rel="stylesheet">

  <!-- Styles -->
  <link href="/assets/css/main.css" rel="stylesheet">
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/monokai_sublime.min.css">
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>


</head>


  <body>

    <div id="primary" class="col-sm-12">
      <div class="content">
      <a href="https://github.com/alanhoff/alanhoff.com"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"></a>

        <header class="header">
          <hgroup class="pull-left">
            <h1 class="site-title">
              
              <a rel="home" title="Alan Hoffmeister" href="/">
                <i class="fa fa-newspaper-o"></i> Alan Hoffmeister
              </a>
              
            </h1>
          </hgroup>
          <a href="https://alanhoff.com/rss.xml" class="btn btn-primary pull-right">
            <i class="fa fa-rss"></i>
          </a>
        </header> <!-- /header -->

        

  
  <img src="/assets/img/posts/embedded.jpg" class="img-responsive">
  
  <section class="post">
    <header class="entry-header">
      <img class="entry-avatar" alt="Paul Laros" height="52" width="52" src="//www.gravatar.com/avatar/6350d3781efe9d1a3a88542771ee39d4.jpg?s=52">
      <h1 class="entry-title"><a href="posts/compilando-o-nodejs-para-sistemas-embarcados.html">Compilando o Node.js para sistemas embarcados</a></h1>
      <p class="entry-meta">
        Postado em 2015-01-27 19:00 | Por <a class="entry-author" href="https://twitter.com/alan_hoff">Alan Hoffmeister</a>
      </p>
    </header>
    <div class="entry-description">
        <p>Você sabia que o Node.js pode rodar normalmente dentro da sua Raspbepry Pi ou
da sua BeagleBoard? O único problema é que não é tão fácil quanto os
monoclicadores de “Next, Next, Finish” imaginam.
<!--more--></p>
<p>Por algum motivo obscuro e desconhecido por minha pessoa, a Joyent não gosta
de disponibilizar binários pré compilados do Node.js para sistemas embarcados,
igual ela faz para o Linux, Windows, Mac e SunOS.. Isso é uma pena pois
facilitaria muito a vida das pessoas que querem se aventurar no mundo dos
sistemas embarcados e construir sistemas dentro de placas do tamanho de um
cartão de crédito.</p>
<p>Muitos tutoriais e recursos que encontramos na internet estão desatualizados
e não são claros quanto ao que fazemos durante o percurso da compilação
deixando aquele ar de “wtf are those magic words”, por isso resolvi comentar
um pouco sobre o assunto.</p>
<p><img src="/assets/img/posts/wtf.gif" alt=""></p>
<h3 id="antes-de-come-ar">Antes de começar</h3>
<p>Para que tudo funcione bem precisamos ter certeza que temos todos os requisitos
abaixo:</p>
<ul>
<li>Uma placa com processador capaz de interpretar o conjunto de instruções ARMv7</li>
<li>Ubuntu 14.10 (achou que iríamos compilar algo no Windows?)</li>
<li>Boa vontade e paciência</li>
<li>Pacotes <code>build-essential</code>, <code>curl</code> e <code>xz-util</code> instalado no seu sistema.</li>
</ul>
<p>Caso você não esteja rodando esta versão do Linux, pode tentar com qualquer
outra, tenho certeza que não será complicado. Se tudo der errado, tente
instalar o Ubuntu 14.10 em uma VM.</p>
<h3 id="o-toolchain">O toolchain</h3>
<p>Primeiramente crie uma pasta para servir de diretório de trabalho, com o comando
<code>mkdir node4arm &amp;&amp; cd node4arm</code>. A primeira coisa que precisamos ter em mãos
é o compilador compatível com o processador da placa que usaremos, no meu caso
vou precisar de um compilador com a interface binária (ABI) que compile
instruções para processadores da família ARMv7, então faremos o download.</p>
<pre><code class="lang-bash">curl -s url -s http://archlinuxarm.org/builder/xtools/x-tools7h.tar.xz | tar xvJf -
</code></pre>
<p>Este comando irá criar uma pasta chamada x-tools7h, dentro da qual exite o
compilador e as ferramentas que precisamos para transformar o nosso código C/++
em instruções binárias.</p>
<p><strong>Dica:</strong> se o conjunto de informações do processador da sua placa não for ARMv7
ou se você está em dúvida acesse sua placa e em um terminal digite
<code>less /proc/cpuinfo</code>, este comando vai mostrar na sua tela informações
importantes sobre o processador da sua placa, depois basta visitar
<a href="http://archlinuxarm.org/builder/xtools">http://archlinuxarm.org/builder/xtools</a> e baixar a versão correspondente ao seu
processador.</p>
<h3 id="o-node-js">O Node.js</h3>
<p>O próximo passo é baixar o código fonte do Node.js e descompactá-lo, utilize
este comando:</p>
<pre><code class="lang-bash">curl -s http://nodejs.org/dist/v0.10.36/node-v0.10.36.tar.gz | tar zxvf -
</code></pre>
<p>Usando o comando <code>cd node-v0.10.36</code>, entre na pasta para iniciar a configuração
e a compilação.</p>
<h3 id="compilando">Compilando</h3>
<p>O último passo é setar algumas variáveis de ambiente, algumas flags e compilar
o binário! Utilize o script abaixo para isso</p>
<pre><code class="lang-bash"># Dizemos onde estão nossos compiladores
export PATH=&quot;$(pwd)/../x-tools7h/arm-unknown-linux-gnueabihf/bin:$PATH&quot;
export TOOL_PREFIX=&quot;arm-unknown-linux-gnueabihf&quot;
export AR=&quot;${TOOL_PREFIX}-ar&quot;
export CC=&quot;${TOOL_PREFIX}-gcc&quot;
export CXX=&quot;${TOOL_PREFIX}-g++&quot;
export LINK=&quot;${TOOL_PREFIX}-g++&quot;
export RANLIB=&quot;${TOOL_PREFIX}-ranlib&quot;

# Configuramos o binário que queremos compilar para
# que seja para sistemas com hard float point e sem snapshot
./configure --with-arm-float-abi hard --without-snapshot

# Compilar!
make
</code></pre>
<p>Note que usamos algumas flags para a configuração da compilação,
<code>--with-arm-float-abi hard</code> serve para setarmos a compilação para usar a ABI com
hard float point, enquanto <code>--whitout-snapshot</code> serve para desabilitar o serviço
de snapshots da V8, que não é compatível com cross compiling.</p>
<p>Depois de rodar este script, o seu binário estará localizado na pasta
<code>./out/Release</code>.</p>
<h3 id="b-nus">Bônus</h3>
<p>Para automatizar o processo criei um script que pode ser encontrado <a href="https://alanhoff.com/assets/etc/node-latest-armv7-generic.sh">aqui</a>,
basta rodá-lo em qualquer pasta vazia com permissões de escrita, ele já faz
o download da última versão do Node.js e compila o source com todos os cores
disponíveis na sua máquina. Para executar o script basta executar:</p>
<pre><code class="lang-bash">curl -s https://alanhoff.com/assets/etc/node-latest-armv7-generic.sh | bash
</code></pre>

    </div>
  </section>

  <section class="post">
    <header class="entry-header">
      <h1 class="entry-title"><a href="https://unijs.com.br/workshop/restful-apis-nodejs.html">Curso sobre Node.js</a></h1>
      <p class="entry-meta">
        Um pouco de publicidade não mata ninguém :-)
      </p>
    </header>
    <div class="entry-description">
        <p>Gostou deste texto? Gostaria de aprender a fazer APIs robustas e escaláveis utilizando Node.js? Participe do meu novo curso presencial <a href="https://unijs.com.br/workshop/restful-apis-nodejs.html">Workshop de APIs</a> e aprenda de um jeito fácil e prático como criar APIs sólidas e escaláveis para seus projetos ou empresa.</p>
        <div class="col-md-2 col-md-offset-5">
          <a href="https://unijs.com.br/workshop/restful-apis-nodejs.html" class="btn btn-lg btn-success">Inscrever-se!</a>
        </div>
        <br style="clear: both">
    </div>
  </section>

  <div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'alanhoffmeister'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
  </div>


        <footer class="footer">
          <p>Conteúdo sob <a href="https://pt.wikipedia.org/wiki/Licen%C3%A7a_ISC">licença ISC</a>. 2014 - Alan Hofmeister</p>
          <div class="socials-footer">
            <a class="btn btn-facebook" href="https://www.facebook.com/alan.hoffmeister" title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
            <a class="btn btn-twitter" href="https://twitter.com/alan_hoff" title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
            <a class="btn btn-linkedin" href="http://br.linkedin.com/in/alanhoff" title="LinkedIn">
              <i class="fa fa-linkedin"></i>
            </a>
            <a class="btn btn-google-plus" href="https://plus.google.com/+alanhoffmeister" title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
            <a class="btn btn-github" href="https://github.com/alanhoff" title="GitHub">
              <i class="fa fa-github"></i>
            </a>
            <a class="btn btn-bitbucket" href="https://bitbucket.org/alanhoff" title="Bitbucket">
              <i class="fa fa-bitbucket"></i>
            </a>
          </div> <!-- /.socials-footer -->
        </footer> <!-- /footer -->

      </div>
    </div> <!-- /#primary -->

    <!-- Scripts -->
    <script src="/assets/js/jquery-1.11.0.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script type="text/javascript">
  $('code').each(function(){
    var el = $(this);
    var content = el.text();
    var lang = el.attr('class') || '';
    lang = lang.indexOf('lang-') === 0 ? lang.substring(5) : 'html';
    el.html(hljs.highlight(lang, content).value);
  });
</script>


  </body>
</html>
